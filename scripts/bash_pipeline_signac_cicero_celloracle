# shebang goes here.

module load R/4.3
#Rscript run_cicero_parallel.R /hpc/projects/data.science/yangjoon.kim/zebrahub_multiome/data/processed_data/TDR118_cicero_output/TDR118_gene_activity.RDS "peaks_bulk" "umap.atac" /hpc/projects/data.science/yangjoon.kim/zebrahub_multiome/data/processed_data/TDR118_cicero_output_MACS2peaks/ "TDR118" "MACS2_bulk"

Rscript run_02_compute_CCANS_cicero.R /hpc/projects/data.science/yangjoon.kim/zebrahub_multiome/data/processed_data/TDR124_cicero_output/TDR124_processed.RDS "ATAC" "UMAP.ATAC" /hpc/projects/data.science/yangjoon.kim/zebrahub_multiome/data/processed_data/TDR124_cicero_output/ "TDR124" "CRG_arc"


# CellOracle env (python)
module load anaconda
conda activate celloracle_env

python run_03_celloracle_filter_CCANS_map_to_genes.py \
    /hpc/projects/data.science/yangjoon.kim/zebrahub_multiome/data/processed_data/TDR124_cicero_output/ \
        "01_TDR124_CRG_arc_peaks.csv" \
        "02_TDR124_cicero_connections_CRG_arc_peaks.csv" \
        0.8 "03_TDR124_processed_peak_file_danRer11.csv" False None

python run_04_celloracle_compute_baseGRN.py \
    /hpc/projects/data.science/yangjoon.kim/zebrahub_multiome/data/processed_data/TDR124_cicero_output/ \
        "03_TDR124_processed_peak_file_danRer11.csv" \
        "TDR124" "danRer11" 10

# Make sure to re-activate the R/4.3 (as we'd need some R dependencies)
python run_05_celloracle_compute_celltype_GRNs.py \
    /hpc/projects/data.science/yangjoon.kim/zebrahub_multiome/data/processed_data/TDR125_cicero_output/\
    /hpc/projects/data.science/yangjoon.kim/zebrahub_multiome/data/processed_data/TDR125_cicero_output/TDR125_processed_RNA.h5ad \
    /hpc/projects/data.science/yangjoon.kim/zebrahub_multiome/data/processed_data/TDR125_cicero_output/05_TDR125_base_GRN_dataframe.parquet \
    "TDR125" "global_annotation" "X_umap.atac"